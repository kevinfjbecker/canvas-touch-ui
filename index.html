<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controller</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <!--
    todo:
      [x] get css up
      [x] just to draw them
        [x] the analog on
        [x] get the button on
        [x] try modular script
      [x] get interactivity
        [x] analog
        [x] button
      [x] multitouch
        [x] uninfy touch handlers
        [x] encapsulate touch handlers
        [ ] generalize touch handlers
        [ ] dispose of touch handlers
    bugs:
      [ ] reposition on resize
      [x] paint spill (button color on analog touch)
     -->

    <div class="full-screen">
        <canvas></canvas>
    </div>

    <script type="module">

        import { analog } from './js/analog.js'
        import { button } from './js/button.js'
        import TouchController from './js/touch.js'

        ///////////////////////////////////////////////////////////////////////

        const fullscreenDiv = document.querySelector('div.full-screen')
        const canvas = document.querySelector('canvas')

        const width = fullscreenDiv.offsetWidth
        const height = fullscreenDiv.offsetHeight

        canvas.width = width
        canvas.height = height

        const ctx = canvas.getContext('2d')

        ///////////////////////////////////////////////////////////////////////

        const analogCenter = {
            x: 95,
            y: height - 95
        }

        const analogControl = analog(analogCenter)

        ///////////////////////////////////////////////////////////////////////

        const butonCenter = {
            x: width / 2,
            y: height / 2
        }

        const buttonControl = button(butonCenter)

        ///////////////////////////////////////////////////////////////////////

        const touchController = new TouchController(
            canvas,
            analogControl,
            buttonControl
        )

        ///////////////////////////////////////////////////////////////////////

        function animateUi() {

            ctx.clearRect(0, 0, canvas.width, canvas.height)

            ///////////////////////////////////////////////////////////////////

            buttonControl.draw(ctx)
            analogControl.draw(ctx)

            ///////////////////////////////////////////////////////////////////

            requestAnimationFrame(animateUi)
        }

        ///////////////////////////////////////////////////////////////////////

        animateUi()

        ///////////////////////////////////////////////////////////////////////
    </script>

</body>

</html>